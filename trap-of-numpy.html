<!doctype html>
<html class="no-js" lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<title>kamidox.com</title>
		<meta name="description" content="">
		<meta name="author" content="Joey Huang">

		<link rel="stylesheet" href="./theme/css/foundation.css" />
		<link rel="stylesheet" href="./theme/css/pygment/monokai.css" />
		<link rel="stylesheet" href="./theme/css/custom.css" />


		<link rel="shortcut icon" href="./theme/img/favicon.ico">

		<script src="./theme/js/modernizr.js"></script>

		<!-- Feeds -->


		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
		<script>
		MathJax.Hub.Config({
		  config: ["MMLorHTML.js"],
		  extensions: ["tex2jax.js"],
		  jax: ["input/TeX", "output/HTML-CSS", "output/NativeMML"],
		  tex2jax: {
		    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
		    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
		    processEscapes: true
		  },
		  TeX: {
		    extensions: ["AMSmath.js", "AMSsymbols.js"],
		    TagSide: "right",
		    TagIndent: ".8em",
		    MultLineWidth: "85%",
		    equationNumbers: {
		      autoNumber: "AMS",
		    },
		    unicode: {
		      fonts: "STIXGeneral,'Arial Unicode MS'"
		    }
		  },
		  displayAlign: "center",
		  showProcessingMessages: false,
		  messageStyle: 'none'
		});
		</script>
	</head>
	<body>
		<div class="off-canvas-wrap">
			<div class="inner-wrap">
				<!-- mobile top bar to activate nav -->
				<nav class="tab-bar show-for-small">
					<section class="left-small">
						<a class="left-off-canvas-toggle menu-icon" ><span></span></a>
					</section>

					<section class="middle tab-bar-section">
						<h1 class="title">kamidox.com</h1>
					</section>
				</nav>

				<!-- mobile side bar nav -->
				<aside class="left-off-canvas-menu">
					<ul class="off-canvas-list">
							<li><a href="http://blog.kamidox.com">Home</a></li>
							<li><a href="http://blog.kamidox.com/about.html">About</a></li>

						<li><label>Categories</label></li>
							<li ><a href="./category/android.html">android</a></li>
							<li ><a href="./category/essay.html">essay</a></li>
							<li ><a href="./category/flask.html">flask</a></li>
							<li class="active"><a href="./category/ml.html">ml</a></li>
							<li ><a href="./category/nlp.html">nlp</a></li>
							<li ><a href="./category/python.html">python</a></li>
							<li ><a href="./category/tools.html">tools</a></li>
							<li ><a href="./category/weapp.html">weapp</a></li>
							<li ><a href="./category/web.html">web</a></li>
							<li ><a href="./category/werkzeug.html">werkzeug</a></li>




						<li><label>Monthly Archives</label></li>
									<li><a href="/posts/2018/03/index.html">March 2018 (1)</a></li>
									<li><a href="/posts/2017/05/index.html">May 2017 (2)</a></li>
									<li><a href="/posts/2017/04/index.html">April 2017 (1)</a></li>
									<li><a href="/posts/2017/02/index.html">February 2017 (1)</a></li>
									<li><a href="/posts/2017/01/index.html">January 2017 (1)</a></li>
									<li><a href="/posts/2016/12/index.html">December 2016 (2)</a></li>
									<li><a href="/posts/2016/11/index.html">November 2016 (3)</a></li>
									<li><a href="/posts/2016/10/index.html">October 2016 (1)</a></li>
									<li><a href="/posts/2016/09/index.html">September 2016 (1)</a></li>
									<li><a href="/posts/2016/03/index.html">March 2016 (2)</a></li>
									<li><a href="/posts/2016/02/index.html">February 2016 (2)</a></li>
									<li><a href="/posts/2016/01/index.html">January 2016 (2)</a></li>
									<li><a href="/posts/2015/12/index.html">December 2015 (10)</a></li>
									<li><a href="/posts/2015/11/index.html">November 2015 (6)</a></li>
									<li><a href="/posts/2015/10/index.html">October 2015 (2)</a></li>
									<li><a href="/posts/2015/09/index.html">September 2015 (7)</a></li>
									<li><a href="/posts/2015/08/index.html">August 2015 (1)</a></li>
									<li><a href="/posts/2015/07/index.html">July 2015 (1)</a></li>
									<li><a href="/posts/2015/05/index.html">May 2015 (1)</a></li>
									<li><a href="/posts/2015/04/index.html">April 2015 (1)</a></li>
									<li><a href="/posts/2015/03/index.html">March 2015 (3)</a></li>
									<li><a href="/posts/2015/02/index.html">February 2015 (2)</a></li>
									<li><a href="/posts/2015/01/index.html">January 2015 (2)</a></li>
									<li><a href="/posts/2014/12/index.html">December 2014 (3)</a></li>
									<li><a href="/posts/2014/11/index.html">November 2014 (4)</a></li>
									<li><a href="/posts/2014/10/index.html">October 2014 (6)</a></li>
									<li><a href="/posts/2014/09/index.html">September 2014 (1)</a></li>
									<li><a href="/posts/2014/07/index.html">July 2014 (1)</a></li>


					</ul>
				</aside>

				<!-- top bar nav -->
				<nav class="top-bar hide-for-small-only" data-topbar>
					<ul class="title-area">
						<li class="name">
							<h1><a href="./">kamidox.com</a></h1>
						</li>
					</ul>

					<section class="top-bar-section">
						<ul class="left">
								<li><a href="http://blog.kamidox.com">Home</a></li>
								<li><a href="http://blog.kamidox.com/about.html">About</a></li>

						</ul>
					</section>
				</nav>

				<!-- Main Page Content and Sidebar -->
				<section class="main-section">
					<div class="row">
						<!-- Main Content -->
						<div class="medium-9 small-12 columns" role="content">
<article>
	<h2>numpy 矩阵运算的陷阱</h2>
	<h2 id="_1">陷阱一：数据结构混乱</h2>
<p>array 和 matrix 都可以用来表示多维矩阵</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%">In [<span style="color: #666666">98</span>]: a <span style="color: #666666">=</span> np<span style="color: #666666">.</span>array([[<span style="color: #666666">1</span>, <span style="color: #666666">2</span>, <span style="color: #666666">3</span>], [<span style="color: #666666">4</span>, <span style="color: #666666">5</span>, <span style="color: #666666">6</span>], [<span style="color: #666666">7</span>, <span style="color: #666666">8</span>, <span style="color: #666666">9</span>]])

In [<span style="color: #666666">99</span>]: a
Out[<span style="color: #666666">99</span>]:
array([[<span style="color: #666666">1</span>, <span style="color: #666666">2</span>, <span style="color: #666666">3</span>],
       [<span style="color: #666666">4</span>, <span style="color: #666666">5</span>, <span style="color: #666666">6</span>],
       [<span style="color: #666666">7</span>, <span style="color: #666666">8</span>, <span style="color: #666666">9</span>]])

In [<span style="color: #666666">100</span>]: A <span style="color: #666666">=</span> np<span style="color: #666666">.</span>matrix([[<span style="color: #666666">1</span>, <span style="color: #666666">2</span>, <span style="color: #666666">3</span>], [<span style="color: #666666">4</span>, <span style="color: #666666">5</span>, <span style="color: #666666">6</span>], [<span style="color: #666666">7</span>, <span style="color: #666666">8</span>, <span style="color: #666666">9</span>]])

In [<span style="color: #666666">101</span>]: A
Out[<span style="color: #666666">101</span>]:
matrix([[<span style="color: #666666">1</span>, <span style="color: #666666">2</span>, <span style="color: #666666">3</span>],
        [<span style="color: #666666">4</span>, <span style="color: #666666">5</span>, <span style="color: #666666">6</span>],
        [<span style="color: #666666">7</span>, <span style="color: #666666">8</span>, <span style="color: #666666">9</span>]])

In [<span style="color: #666666">102</span>]: a<span style="color: #666666">.</span>shape
Out[<span style="color: #666666">102</span>]: (<span style="color: #666666">3</span>, <span style="color: #666666">3</span>)

In [<span style="color: #666666">103</span>]: A<span style="color: #666666">.</span>shape
Out[<span style="color: #666666">103</span>]: (<span style="color: #666666">3</span>, <span style="color: #666666">3</span>)
</pre></div>


<p>看起来效果不错。假设我们要对数据进行筛选，取第 1 列的第 1 行和第 3 行数据构成一个 2 x 1 的列向量。先看对 array 的做法</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%">In [<span style="color: #666666">99</span>]: a
Out[<span style="color: #666666">99</span>]:
array([[<span style="color: #666666">1</span>, <span style="color: #666666">2</span>, <span style="color: #666666">3</span>],
       [<span style="color: #666666">4</span>, <span style="color: #666666">5</span>, <span style="color: #666666">6</span>],
       [<span style="color: #666666">7</span>, <span style="color: #666666">8</span>, <span style="color: #666666">9</span>]])

In [<span style="color: #666666">100</span>]: y
Out[<span style="color: #666666">100</span>]:
matrix([[<span style="color: #666666">1</span>],
        [<span style="color: #666666">0</span>],
        [<span style="color: #666666">1</span>]])

In [<span style="color: #666666">101</span>]: a[:, <span style="color: #666666">0</span>]
Out[<span style="color: #666666">101</span>]: array([<span style="color: #666666">1</span>, <span style="color: #666666">4</span>, <span style="color: #666666">7</span>])

In [<span style="color: #666666">102</span>]: a[:, <span style="color: #666666">0</span>]<span style="color: #666666">.</span>shape
Out[<span style="color: #666666">102</span>]: (<span style="color: #666666">3</span>,)

In [<span style="color: #666666">110</span>]: a[:, <span style="color: #666666">0</span>][y <span style="color: #666666">==</span> <span style="color: #666666">1</span>]
<span style="color: #666666">---------------------------------------------------------------------------</span>
<span style="color: #D2413A; font-weight: bold">IndexError</span>                                Traceback (most recent call last)
<span style="color: #666666">&lt;</span>ipython<span style="color: #666666">-</span><span style="color: #AA22FF">input</span><span style="color: #666666">-110-</span>f32ed63aa2a8<span style="color: #666666">&gt;</span> <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #666666">&lt;</span>module<span style="color: #666666">&gt;</span>()
<span style="color: #666666">----&gt;</span> <span style="color: #666666">1</span> a[:, <span style="color: #666666">0</span>][y <span style="color: #666666">==</span> <span style="color: #666666">1</span>]

<span style="color: #D2413A; font-weight: bold">IndexError</span>: too many indices <span style="color: #AA22FF; font-weight: bold">for</span> array

In [<span style="color: #666666">111</span>]: a[:, <span style="color: #666666">0</span>]<span style="color: #666666">.</span>reshape(<span style="color: #666666">3</span>, <span style="color: #666666">1</span>)[y <span style="color: #666666">==</span> <span style="color: #666666">1</span>]
Out[<span style="color: #666666">111</span>]: array([<span style="color: #666666">1</span>, <span style="color: #666666">7</span>])
</pre></div>


<p>从 Out[101] 可以看到一个陷阱，<code>a[:, 0]</code> 过滤完应该是一个 3 x 1 的列向量，可是它变成了行向量。其实也不是真正意义上的行向量，因为行向量 shape 应该是 3 x 1，可是他的 shape 是 (3,) ，这其实已经退化为一个数组了。所以，导致最后 In [110] 出错。只有像 In [111] 那样 reshape 一下才可以。我不知道大家晕了没有，我是已经快晕了。</p>
<p>相比之下，matrix 可以确保运算结果全部是二维的，结果相对好一点。为什么只是相对好一点呢？呆会儿我们再来吐吐 matrix 的槽点。</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%">In [<span style="color: #666666">101</span>]: A
Out[<span style="color: #666666">101</span>]:
matrix([[<span style="color: #666666">1</span>, <span style="color: #666666">2</span>, <span style="color: #666666">3</span>],
        [<span style="color: #666666">4</span>, <span style="color: #666666">5</span>, <span style="color: #666666">6</span>],
        [<span style="color: #666666">7</span>, <span style="color: #666666">8</span>, <span style="color: #666666">9</span>]])

In [<span style="color: #666666">112</span>]: y
Out[<span style="color: #666666">112</span>]:
matrix([[<span style="color: #666666">1</span>],
        [<span style="color: #666666">0</span>],
        [<span style="color: #666666">1</span>]])

In [<span style="color: #666666">113</span>]: A[:,<span style="color: #666666">0</span>]
Out[<span style="color: #666666">113</span>]:
matrix([[<span style="color: #666666">1</span>],
        [<span style="color: #666666">4</span>],
        [<span style="color: #666666">7</span>]])

In [<span style="color: #666666">102</span>]: A[:, <span style="color: #666666">0</span>]<span style="color: #666666">.</span>shape
Out[<span style="color: #666666">102</span>]: (<span style="color: #666666">3</span>,<span style="color: #666666">1</span>)

In [<span style="color: #666666">114</span>]: A[:,<span style="color: #666666">0</span>][y <span style="color: #666666">==</span> <span style="color: #666666">1</span>]
Out[<span style="color: #666666">114</span>]: matrix([[<span style="color: #666666">1</span>, <span style="color: #666666">7</span>]])

In [<span style="color: #666666">114</span>]: A[:,<span style="color: #666666">0</span>][y <span style="color: #666666">==</span> <span style="color: #666666">1</span>]<span style="color: #666666">.</span>shape
Out[<span style="color: #666666">114</span>]: (<span style="color: #666666">1</span>,<span style="color: #666666">2</span>)
</pre></div>


<p>看起来还不错。不过槽点就来了。Out [114] 我们预期的输入结果应该是一个 2 x 1 的列向量，可是这里变成了 1 x 2 的行向量！</p>
<p>为什么我会在意行向量和列向量？在矩阵运算里，行向量和列向量是不同的。比如一个 m x 3 的矩阵可以和 3 x 1 的列向量叉乘，结果是 m x 1 的列向量。而如果一个 m x 3 的矩阵和 1 x 3 的行向量叉乘是会报错的。</p>
<h2 id="_2">陷阱二：数据处理能力不足，语言效率低</h2>
<p>我们再看个例子。假设 X 是 5 x 2 的矩阵，Y 是 5 X 1 的 bool 矩阵，我们想用 Y 来过滤 X ，即取出 Y 值为 True 的项的索引，拿这些索引去 X 里找出对应的行，再组合成一个新矩阵。</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%">In [<span style="color: #666666">79</span>]: X
Out[<span style="color: #666666">79</span>]:
matrix([[ <span style="color: #666666">34.62365962</span>,  <span style="color: #666666">78.02469282</span>],
        [ <span style="color: #666666">30.28671077</span>,  <span style="color: #666666">43.89499752</span>],
        [ <span style="color: #666666">35.84740877</span>,  <span style="color: #666666">72.90219803</span>],
        [ <span style="color: #666666">60.18259939</span>,  <span style="color: #666666">86.3085521</span> ],
        [ <span style="color: #666666">79.03273605</span>,  <span style="color: #666666">75.34437644</span>]])

In [<span style="color: #666666">80</span>]: Y
Out[<span style="color: #666666">80</span>]:
matrix([[ <span style="color: #AA22FF">True</span>],
        [<span style="color: #AA22FF">False</span>],
        [ <span style="color: #AA22FF">True</span>],
        [ <span style="color: #AA22FF">True</span>],
        [<span style="color: #AA22FF">False</span>]], dtype<span style="color: #666666">=</span><span style="color: #AA22FF">bool</span>)

In [<span style="color: #666666">81</span>]: X[Y <span style="color: #666666">==</span> <span style="color: #AA22FF">True</span>]
Out[<span style="color: #666666">81</span>]: matrix([[ <span style="color: #666666">34.62365962</span>,  <span style="color: #666666">35.84740877</span>,  <span style="color: #666666">60.18259939</span>]])

In [<span style="color: #666666">85</span>]: X[Y <span style="color: #666666">==</span> <span style="color: #AA22FF">True</span>, :]
<span style="color: #666666">---------------------------------------------------------------------------</span>
<span style="color: #D2413A; font-weight: bold">IndexError</span>                                Traceback (most recent call last)
<span style="color: #666666">&lt;</span>ipython<span style="color: #666666">-</span><span style="color: #AA22FF">input</span><span style="color: #666666">-85-2</span>aeabbc2bcc5<span style="color: #666666">&gt;</span> <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #666666">&lt;</span>module<span style="color: #666666">&gt;</span>()
<span style="color: #666666">----&gt;</span> <span style="color: #666666">1</span> X[Y <span style="color: #666666">==</span> <span style="color: #AA22FF">True</span>, :]

C:\Python27\lib\site<span style="color: #666666">-</span>packages\numpy\matrixlib\defmatrix<span style="color: #666666">.</span>pyc <span style="color: #AA22FF; font-weight: bold">in</span> __getitem__(<span style="color: #AA22FF">self</span>, index)
    <span style="color: #666666">314</span>
    <span style="color: #666666">315</span>         <span style="color: #AA22FF; font-weight: bold">try</span>:
<span style="color: #666666">--&gt;</span> <span style="color: #666666">316</span>             out <span style="color: #666666">=</span> N<span style="color: #666666">.</span>ndarray<span style="color: #666666">.</span>__getitem__(<span style="color: #AA22FF">self</span>, index)
    <span style="color: #666666">317</span>         <span style="color: #AA22FF; font-weight: bold">finally</span>:
    <span style="color: #666666">318</span>             <span style="color: #AA22FF">self</span><span style="color: #666666">.</span>_getitem <span style="color: #666666">=</span> <span style="color: #AA22FF">False</span>

<span style="color: #D2413A; font-weight: bold">IndexError</span>: too many indices <span style="color: #AA22FF; font-weight: bold">for</span> array

In [<span style="color: #666666">86</span>]: X[:, <span style="color: #666666">0</span>][Y <span style="color: #666666">==</span> <span style="color: #AA22FF">True</span>]
Out[<span style="color: #666666">86</span>]: matrix([[ <span style="color: #666666">34.62365962</span>,  <span style="color: #666666">35.84740877</span>,  <span style="color: #666666">60.18259939</span>]])

In [<span style="color: #666666">87</span>]: X[:, <span style="color: #666666">1</span>][Y <span style="color: #666666">==</span> <span style="color: #AA22FF">True</span>]
Out[<span style="color: #666666">87</span>]: matrix([[ <span style="color: #666666">78.02469282</span>,  <span style="color: #666666">72.90219803</span>,  <span style="color: #666666">86.3085521</span> ]])

In [<span style="color: #666666">88</span>]: np<span style="color: #666666">.</span>column_stack((x[:, <span style="color: #666666">0</span>][y <span style="color: #666666">==</span> <span style="color: #AA22FF">True</span>]<span style="color: #666666">.</span>reshape(<span style="color: #666666">3</span>,<span style="color: #666666">1</span>), x[:, <span style="color: #666666">1</span>][y <span style="color: #666666">==</span> <span style="color: #AA22FF">True</span>]<span style="color: #666666">.</span>reshape(<span style="color: #666666">3</span>,<span style="color: #666666">1</span>)))
Out[<span style="color: #666666">88</span>]:
matrix([[ <span style="color: #666666">34.62365962</span>,  <span style="color: #666666">78.02469282</span>],
        [ <span style="color: #666666">35.84740877</span>,  <span style="color: #666666">72.90219803</span>],
        [ <span style="color: #666666">60.18259939</span>,  <span style="color: #666666">86.3085521</span> ]])
</pre></div>


<p>我们预期 X 过滤完是 3 x 2 列的矩阵，但不幸的是从 Out[81] 来看 numpy 这样过滤完只会保留第一列的数据，且把它转化成了行向量，即变成了 1 x 3 的行向量。不知道你有没有抓狂的感觉。如果按照 In [85] 的写法，还会报错。如果要正确地过滤不同的列，需要写成 In [86] 和 In [87] 的形式。但是即使写成 In [86] 和 In [87] 的样式，还是一样把列向量转化成了行向量。所以，要实现这个目的，得复杂到按照 In [88] 那样才能达到目的。实际上，这个还达不到目的，因为那里面写了好多硬编码的数字，要处理通用的过滤情况，还需要写个函数来实现。而这个任务在 matlab/octave 里只需要写成 <code>X(Y==1, :)</code> 即可完美达成目的。</p>
<h2 id="_3">陷阱三：数值运算句法混乱</h2>
<p>在机器学习算法里，经常要做一些矩阵运算。有时候要做叉乘，有时候要做点乘。我们看一下 numpy 是如何满足这个需求的。</p>
<p>假设 x, y, theta 的值如下，我们要先让 x 和 y 点乘，再让结果与 theta 叉乘，最后的结果我们期望的是一个 5 x 1 的列向量。</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%">In [<span style="color: #666666">22</span>]: x
Out[<span style="color: #666666">22</span>]:
matrix([[  <span style="color: #666666">1.</span>        ,  <span style="color: #666666">34.62365962</span>,  <span style="color: #666666">78.02469282</span>],
        [  <span style="color: #666666">1.</span>        ,  <span style="color: #666666">30.28671077</span>,  <span style="color: #666666">43.89499752</span>],
        [  <span style="color: #666666">1.</span>        ,  <span style="color: #666666">35.84740877</span>,  <span style="color: #666666">72.90219803</span>],
        [  <span style="color: #666666">1.</span>        ,  <span style="color: #666666">60.18259939</span>,  <span style="color: #666666">86.3085521</span> ],
        [  <span style="color: #666666">1.</span>        ,  <span style="color: #666666">79.03273605</span>,  <span style="color: #666666">75.34437644</span>]])

In [<span style="color: #666666">23</span>]: y
Out[<span style="color: #666666">23</span>]:
matrix([[<span style="color: #666666">1</span>],
        [<span style="color: #666666">2</span>],
        [<span style="color: #666666">3</span>],
        [<span style="color: #666666">2</span>],
        [<span style="color: #666666">2</span>]])

In [<span style="color: #666666">24</span>]: theta
Out[<span style="color: #666666">24</span>]:
matrix([[<span style="color: #666666">2</span>],
        [<span style="color: #666666">2</span>],
        [<span style="color: #666666">2</span>]])
</pre></div>


<p>直观地讲，我们应该会想这样做：(x 点乘 y) 叉乘 theta。但很不幸，当你输入 <code>x * y</code> 时妥妥地报错。那好吧，我们这样做总行了吧，<code>x[:, 0] * y</code> 这样两个列向量就可以点乘了吧，不幸的还是不行，因为 numpy 认为这是 matrix，所以执行的是矩阵相乘（叉乘），要做点乘，必须转为 array 。</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%">In [<span style="color: #666666">37</span>]: x <span style="color: #666666">*</span> y
<span style="color: #666666">---------------------------------------------------------------------------</span>
<span style="color: #D2413A; font-weight: bold">ValueError</span>                                Traceback (most recent call last)
<span style="color: #666666">&lt;</span>ipython<span style="color: #666666">-</span><span style="color: #AA22FF">input</span><span style="color: #666666">-37-</span>ae1a0a4af750<span style="color: #666666">&gt;</span> <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #666666">&lt;</span>module<span style="color: #666666">&gt;</span>()
<span style="color: #666666">----&gt;</span> <span style="color: #666666">1</span> x <span style="color: #666666">*</span> y

<span style="color: #666666">/</span>System<span style="color: #666666">/</span>Library<span style="color: #666666">/</span>Frameworks<span style="color: #666666">/</span>Python<span style="color: #666666">.</span>framework<span style="color: #666666">/</span>Versions<span style="color: #666666">/2.7/</span>Extras<span style="color: #666666">/</span>lib<span style="color: #666666">/</span>python<span style="color: #666666">/</span>numpy<span style="color: #666666">/</span>matrixlib<span style="color: #666666">/</span>defmatrix<span style="color: #666666">.</span>pyc <span style="color: #AA22FF; font-weight: bold">in</span> __mul__(<span style="color: #AA22FF">self</span>, other)
    <span style="color: #666666">339</span>         <span style="color: #AA22FF; font-weight: bold">if</span> <span style="color: #AA22FF">isinstance</span>(other, (N<span style="color: #666666">.</span>ndarray, <span style="color: #AA22FF">list</span>, <span style="color: #AA22FF">tuple</span>)) :
    <span style="color: #666666">340</span>             <span style="color: #008800; font-style: italic"># This promotes 1-D vectors to row vectors</span>
<span style="color: #666666">--&gt;</span> <span style="color: #666666">341</span>             <span style="color: #AA22FF; font-weight: bold">return</span> N<span style="color: #666666">.</span>dot(<span style="color: #AA22FF">self</span>, asmatrix(other))
    <span style="color: #666666">342</span>         <span style="color: #AA22FF; font-weight: bold">if</span> isscalar(other) <span style="color: #AA22FF; font-weight: bold">or</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #AA22FF">hasattr</span>(other, <span style="color: #BB4444">&#39;__rmul__&#39;</span>) :
    <span style="color: #666666">343</span>             <span style="color: #AA22FF; font-weight: bold">return</span> N<span style="color: #666666">.</span>dot(<span style="color: #AA22FF">self</span>, other)

<span style="color: #D2413A; font-weight: bold">ValueError</span>: matrices are <span style="color: #AA22FF; font-weight: bold">not</span> aligned

In [<span style="color: #666666">38</span>]: x[:, <span style="color: #666666">0</span>] <span style="color: #666666">*</span> y
<span style="color: #666666">---------------------------------------------------------------------------</span>
<span style="color: #D2413A; font-weight: bold">ValueError</span>                                Traceback (most recent call last)
<span style="color: #666666">&lt;</span>ipython<span style="color: #666666">-</span><span style="color: #AA22FF">input</span><span style="color: #666666">-38-</span>d55ad841fa29<span style="color: #666666">&gt;</span> <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #666666">&lt;</span>module<span style="color: #666666">&gt;</span>()
<span style="color: #666666">----&gt;</span> <span style="color: #666666">1</span> x[:, <span style="color: #666666">0</span>] <span style="color: #666666">*</span> y

<span style="color: #666666">/</span>System<span style="color: #666666">/</span>Library<span style="color: #666666">/</span>Frameworks<span style="color: #666666">/</span>Python<span style="color: #666666">.</span>framework<span style="color: #666666">/</span>Versions<span style="color: #666666">/2.7/</span>Extras<span style="color: #666666">/</span>lib<span style="color: #666666">/</span>python<span style="color: #666666">/</span>numpy<span style="color: #666666">/</span>matrixlib<span style="color: #666666">/</span>defmatrix<span style="color: #666666">.</span>pyc <span style="color: #AA22FF; font-weight: bold">in</span> __mul__(<span style="color: #AA22FF">self</span>, other)
    <span style="color: #666666">339</span>         <span style="color: #AA22FF; font-weight: bold">if</span> <span style="color: #AA22FF">isinstance</span>(other, (N<span style="color: #666666">.</span>ndarray, <span style="color: #AA22FF">list</span>, <span style="color: #AA22FF">tuple</span>)) :
    <span style="color: #666666">340</span>             <span style="color: #008800; font-style: italic"># This promotes 1-D vectors to row vectors</span>
<span style="color: #666666">--&gt;</span> <span style="color: #666666">341</span>             <span style="color: #AA22FF; font-weight: bold">return</span> N<span style="color: #666666">.</span>dot(<span style="color: #AA22FF">self</span>, asmatrix(other))
    <span style="color: #666666">342</span>         <span style="color: #AA22FF; font-weight: bold">if</span> isscalar(other) <span style="color: #AA22FF; font-weight: bold">or</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #AA22FF">hasattr</span>(other, <span style="color: #BB4444">&#39;__rmul__&#39;</span>) :
    <span style="color: #666666">343</span>             <span style="color: #AA22FF; font-weight: bold">return</span> N<span style="color: #666666">.</span>dot(<span style="color: #AA22FF">self</span>, other)

<span style="color: #D2413A; font-weight: bold">ValueError</span>: matrices are <span style="color: #AA22FF; font-weight: bold">not</span> aligned

In [<span style="color: #666666">39</span>]: sp<span style="color: #666666">.</span>array(x[:,<span style="color: #666666">0</span>]) <span style="color: #666666">*</span> sp<span style="color: #666666">.</span>array(y)
Out[<span style="color: #666666">39</span>]:
array([[ <span style="color: #666666">1.</span>],
       [ <span style="color: #666666">2.</span>],
       [ <span style="color: #666666">3.</span>],
       [ <span style="color: #666666">2.</span>],
       [ <span style="color: #666666">2.</span>]])

In [<span style="color: #666666">42</span>]: xy <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>column_stack(((sp<span style="color: #666666">.</span>array(x[:,<span style="color: #666666">0</span>]) <span style="color: #666666">*</span> sp<span style="color: #666666">.</span>array(y)), (sp<span style="color: #666666">.</span>array(x[:,<span style="color: #666666">1</span>]) <span style="color: #666666">*</span> sp<span style="color: #666666">.</span>array(y)), (sp<span style="color: #666666">.</span>array(x[:,<span style="color: #666666">2</span>]) <span style="color: #666666">*</span> sp<span style="color: #666666">.</span>array(y))))

In [<span style="color: #666666">43</span>]: xy
Out[<span style="color: #666666">43</span>]:
array([[   <span style="color: #666666">1.</span>        ,   <span style="color: #666666">34.62365962</span>,   <span style="color: #666666">78.02469282</span>],
       [   <span style="color: #666666">2.</span>        ,   <span style="color: #666666">60.57342154</span>,   <span style="color: #666666">87.78999504</span>],
       [   <span style="color: #666666">3.</span>        ,  <span style="color: #666666">107.54222631</span>,  <span style="color: #666666">218.70659409</span>],
       [   <span style="color: #666666">2.</span>        ,  <span style="color: #666666">120.36519878</span>,  <span style="color: #666666">172.6171042</span> ],
       [   <span style="color: #666666">2.</span>        ,  <span style="color: #666666">158.0654721</span> ,  <span style="color: #666666">150.68875288</span>]])
</pre></div>


<p>所以，我们需要象 In [39] 那样一列列转为 array 和 y 执行点乘，然后再组合回 5 x 3 的矩阵。好不容易算出了 x 和 y 的点乘了，终于可以和 theta 叉乘了。</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%">In [<span style="color: #666666">44</span>]: xy <span style="color: #666666">*</span> theta
Out[<span style="color: #666666">44</span>]:
matrix([[ <span style="color: #666666">227.29670488</span>],
        [ <span style="color: #666666">300.72683316</span>],
        [ <span style="color: #666666">658.4976408</span> ],
        [ <span style="color: #666666">589.96460596</span>],
        [ <span style="color: #666666">621.50844996</span>]])
</pre></div>


<p>看起来结果还不错，但实际上这里面也是陷阱重重。</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%">In [<span style="color: #666666">45</span>]: xy <span style="color: #666666">*</span> sp<span style="color: #666666">.</span>array(theta)
<span style="color: #666666">---------------------------------------------------------------------------</span>
<span style="color: #D2413A; font-weight: bold">ValueError</span>                                Traceback (most recent call last)
<span style="color: #666666">&lt;</span>ipython<span style="color: #666666">-</span><span style="color: #AA22FF">input</span><span style="color: #666666">-45-5</span>ea2f7324fbe<span style="color: #666666">&gt;</span> <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #666666">&lt;</span>module<span style="color: #666666">&gt;</span>()
<span style="color: #666666">----&gt;</span> <span style="color: #666666">1</span> xy <span style="color: #666666">*</span> sp<span style="color: #666666">.</span>array(theta)

<span style="color: #D2413A; font-weight: bold">ValueError</span>: operands could <span style="color: #AA22FF; font-weight: bold">not</span> be broadcast together <span style="color: #AA22FF; font-weight: bold">with</span> shapes (<span style="color: #666666">5</span>,<span style="color: #666666">3</span>) (<span style="color: #666666">3</span>,<span style="color: #666666">1</span>)

In [<span style="color: #666666">46</span>]: sp<span style="color: #666666">.</span>dot(xy, sp<span style="color: #666666">.</span>array(theta))
Out[<span style="color: #666666">46</span>]:
array([[ <span style="color: #666666">227.29670488</span>],
       [ <span style="color: #666666">300.72683316</span>],
       [ <span style="color: #666666">658.4976408</span> ],
       [ <span style="color: #666666">589.96460596</span>],
       [ <span style="color: #666666">621.50844996</span>]])
</pre></div>


<p>In [45] 会报错，因为在 array 里 <code>*</code> 运算符是点乘，而在 matrix 里 <code>*</code> 运算符是叉乘。如果要在 array 里算叉乘，需要用 <code>dot</code> 方法。看起来提供了灵活性，实际上增加了使用者的大脑负担。而我们的需求在 matlab/octave 里只需要写成 <code>x .* y * theta</code> ，直观优雅。</p>
<h2 id="_4">陷阱四：语法复杂，不自然</h2>
<p>比如，我们要在一个 5 x 2 的矩阵的前面加一列全部是 1 的数据，变成一个 5 x 3 的矩阵，我们必须这样写</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%">In [<span style="color: #666666">11</span>]: x
Out[<span style="color: #666666">11</span>]:
matrix([[ <span style="color: #666666">34.62365962</span>,  <span style="color: #666666">78.02469282</span>],
        [ <span style="color: #666666">30.28671077</span>,  <span style="color: #666666">43.89499752</span>],
        [ <span style="color: #666666">35.84740877</span>,  <span style="color: #666666">72.90219803</span>],
        [ <span style="color: #666666">60.18259939</span>,  <span style="color: #666666">86.3085521</span> ],
        [ <span style="color: #666666">79.03273605</span>,  <span style="color: #666666">75.34437644</span>]])

In [<span style="color: #666666">18</span>]: sp<span style="color: #666666">.</span>column_stack(((sp<span style="color: #666666">.</span>ones((<span style="color: #666666">5</span>,<span style="color: #666666">1</span>)), x)))
Out[<span style="color: #666666">18</span>]:
matrix([[  <span style="color: #666666">1.</span>        ,  <span style="color: #666666">34.62365962</span>,  <span style="color: #666666">78.02469282</span>],
        [  <span style="color: #666666">1.</span>        ,  <span style="color: #666666">30.28671077</span>,  <span style="color: #666666">43.89499752</span>],
        [  <span style="color: #666666">1.</span>        ,  <span style="color: #666666">35.84740877</span>,  <span style="color: #666666">72.90219803</span>],
        [  <span style="color: #666666">1.</span>        ,  <span style="color: #666666">60.18259939</span>,  <span style="color: #666666">86.3085521</span> ],
        [  <span style="color: #666666">1.</span>        ,  <span style="color: #666666">79.03273605</span>,  <span style="color: #666666">75.34437644</span>]])
</pre></div>


<p>有兴趣的人可以数数 In [18] 里有多少个括号，还别不服，括号写少了妥妥地报错。而这个需求在 matlab/octave 里面只需要写成 <code>[ones(5,1) x]</code> ，瞬间脑袋不短路了，直观优雅又回来了。</p>
<h2 id="_5">结论</h2>
<p>有人说 python 是机器学习和数据分析的新贵，但和专门的领域语言 matlab/octave 相比，用起来确实还是比较别扭的。当然有些槽点是因为语言本身的限制，比如 python 不支持自定义操作符，导致 numpy 的一些设计不够优雅和直观，但默认把列向量转化为行向量的做法只能说是 numpy 本身的设计问题了。这或许就是 Andrew Ng 在他的 Machine Learning 课程里用 matlab/octave ，而不用 python 或其他的语言的原因吧。</p>
	<hr/>
	<h6>Post by <a href="./author/joey-huang.html">Joey Huang</a> under <a href="./category/ml.html">ml</a> on 2015-09-30(Wednesday) 20:20. Tags: <a href="./tag/machine-learning.html">machine-learning</a>, </h6>
</article>

<hr/>
<div class="row">
	<div class="small-12 columns">
		<h3>Comments</h3>
		<div id="disqus_thread"></div>
		<script type="text/javascript">
			var disqus_shortname = 'kamidox';
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	</div>
</div>
						</div>
						<!-- End Main Content -->
						<!-- Sidebar -->
						<aside class="medium-3 hide-for-small-only columns">
							<div class="panel">
								<h5>Places</h5>
								<ul class="side-nav">
										<li><a href="http://blog.kamidox.com/feeds/rss.xml" rel="alternate">RSS Feed</a></li>

								</ul>
							</div>


							<div class="panel">
								<h5>Categories</h5>
								<ul class="side-nav">
										<li><a href="./category/android.html">android</a></li>
										<li><a href="./category/essay.html">essay</a></li>
										<li><a href="./category/flask.html">flask</a></li>
										<li><a href="./category/ml.html">ml</a></li>
										<li><a href="./category/nlp.html">nlp</a></li>
										<li><a href="./category/python.html">python</a></li>
										<li><a href="./category/tools.html">tools</a></li>
										<li><a href="./category/weapp.html">weapp</a></li>
										<li><a href="./category/web.html">web</a></li>
										<li><a href="./category/werkzeug.html">werkzeug</a></li>
								</ul>
							</div>

							<div class="panel">
								<h5>Tags</h5>
								<ul class="tag-cloud">
										<li class="tag-4"><a href="./tag/socketserver.html">SocketServer</a></li>
										<li class="tag-2"><a href="./tag/weapp.html">weapp</a></li>
										<li class="tag-2"><a href="./tag/flask.html">flask</a></li>
										<li class="tag-2"><a href="./tag/markdown.html">markdown</a></li>
										<li class="tag-3"><a href="./tag/web.html">web</a></li>
										<li class="tag-2"><a href="./tag/tools.html">tools</a></li>
										<li class="tag-3"><a href="./tag/sublime.html">sublime</a></li>
										<li class="tag-1"><a href="./tag/python.html">python</a></li>
										<li class="tag-4"><a href="./tag/wekzeug.html">wekzeug</a></li>
										<li class="tag-4"><a href="./tag/contacts-provider.html">contacts provider</a></li>
										<li class="tag-2"><a href="./tag/android.html">android</a></li>
										<li class="tag-4"><a href="./tag/patchrom.html">patchrom</a></li>
										<li class="tag-1"><a href="./tag/thought.html">thought</a></li>
										<li class="tag-4"><a href="./tag/nlp.html">nlp</a></li>
										<li class="tag-4"><a href="./tag/miui.html">miui</a></li>
										<li class="tag-4"><a href="./tag/decorator.html">decorator</a></li>
										<li class="tag-1"><a href="./tag/machine-learning.html">machine-learning</a></li>
										<li class="tag-4"><a href="./tag/uml.html">uml</a></li>
										<li class="tag-4"><a href="./tag/contacts.html">contacts</a></li>
										<li class="tag-4"><a href="./tag/ebook.html">ebook</a></li>
										<li class="tag-4"><a href="./tag/react.html">react</a></li>
										<li class="tag-3"><a href="./tag/pelican.html">pelican</a></li>
										<li class="tag-4"><a href="./tag/github.html">github</a></li>
								</ul>
							</div>

							<div class="panel">
								<h5>Monthly Archives</h5>
								<ul class="side-nav">
											<li><a href="/posts/2018/03/index.html">March 2018 (1)</a></li>
											<li><a href="/posts/2017/05/index.html">May 2017 (2)</a></li>
											<li><a href="/posts/2017/04/index.html">April 2017 (1)</a></li>
											<li><a href="/posts/2017/02/index.html">February 2017 (1)</a></li>
											<li><a href="/posts/2017/01/index.html">January 2017 (1)</a></li>
											<li><a href="/posts/2016/12/index.html">December 2016 (2)</a></li>
											<li><a href="/posts/2016/11/index.html">November 2016 (3)</a></li>
											<li><a href="/posts/2016/10/index.html">October 2016 (1)</a></li>
											<li><a href="/posts/2016/09/index.html">September 2016 (1)</a></li>
											<li><a href="/posts/2016/03/index.html">March 2016 (2)</a></li>
											<li><a href="/posts/2016/02/index.html">February 2016 (2)</a></li>
											<li><a href="/posts/2016/01/index.html">January 2016 (2)</a></li>
											<li><a href="/posts/2015/12/index.html">December 2015 (10)</a></li>
											<li><a href="/posts/2015/11/index.html">November 2015 (6)</a></li>
											<li><a href="/posts/2015/10/index.html">October 2015 (2)</a></li>
											<li><a href="/posts/2015/09/index.html">September 2015 (7)</a></li>
											<li><a href="/posts/2015/08/index.html">August 2015 (1)</a></li>
											<li><a href="/posts/2015/07/index.html">July 2015 (1)</a></li>
											<li><a href="/posts/2015/05/index.html">May 2015 (1)</a></li>
											<li><a href="/posts/2015/04/index.html">April 2015 (1)</a></li>
											<li><a href="/posts/2015/03/index.html">March 2015 (3)</a></li>
											<li><a href="/posts/2015/02/index.html">February 2015 (2)</a></li>
											<li><a href="/posts/2015/01/index.html">January 2015 (2)</a></li>
											<li><a href="/posts/2014/12/index.html">December 2014 (3)</a></li>
											<li><a href="/posts/2014/11/index.html">November 2014 (4)</a></li>
											<li><a href="/posts/2014/10/index.html">October 2014 (6)</a></li>
											<li><a href="/posts/2014/09/index.html">September 2014 (1)</a></li>
											<li><a href="/posts/2014/07/index.html">July 2014 (1)</a></li>
								</ul>
							</div>

						</aside>
						<!-- End Sidebar -->
					</div>

					<!-- Footer -->
					<footer class="row">
						<div class="medium-9 small-12">
							<hr/>
							<p class="text-center">Powered by <a href="http://getpelican.com">Pelican</a> and <a href="http://foundation.zurb.com/">Zurb Foundation</a>. Theme by <a href="http://hamaluik.com">Kenton Hamaluik</a>.
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253471695'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/z_stat.php%3Fid%3D1253471695%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
							</p>
						</div>
					</footer>
					<!-- End Footer -->
				</section>
				<a class="exit-off-canvas"></a>
			</div><!--off-canvas inner-->
		</div><!--off-canvas wrap-->

		<script src="./theme/js/jquery.js"></script>
		<script src="./theme/js/foundation.min.js"></script>
		<script>
			$(document).foundation();
		</script>
	</body>
</html>